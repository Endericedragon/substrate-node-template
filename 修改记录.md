# 将pallet_balances的源代码作为pallet引入

原版的substrate-node-template是直接使用了Github上Substrate官方的pallet_balances。为了对pallet_balances进行自定义，我们不能这么做。必须将pallet_balances的源代码引入项目中才行。具体做法如下陈述：

## 获得pallet_balances的源代码

> **注意**：鉴于笔者使用的substrate-node-template全部基于polkadot-0.9.40版本，下载源代码时一定要切换到`polkadot-0.9.40`分支，不然获得的pallet_balances源代码不能用！！

访问[仓库](https://github.com/Endericedragon/substrate/tree/polkadot-v0.9.40)，下载这个仓库分支的源代码。然后，将该仓库源代码中的frame/balances目录复制到substrate-node-template的pallet目录中。

接下来，打开substrate-node-template中的runtime/Cargo.toml，将其中的
```toml
pallet-balances = { version = "4.0.0-dev", default-features = false, git = "https://github.com/paritytech/substrate.git", branch = "polkadot-v0.9.40" }
```
注释掉，在其下方新加一行：
```toml
pallet-balances = { version = "4.0.0-dev", default-features = false, path = "../pallets/balances" }
```

读者可以仔细观察两语句的不同，学习从Github上直接加载pallet和从本地目录加载pallet的异同。

关闭runtime/Cargo.toml，打开pallets/balances/Cargo.toml。将pallet_balances原本从本地引用的pallet改为从Github上引用。其中，注释掉的是polkadot-0.9.40分支中pallet_balances从本地的引用，没有注释的部分是笔者修改的从Github上的引用。

首先修改`[dependencies]`字段中的引用：

```toml
# frame-benchmarking = { version = "4.0.0-dev", default-features = false, optional = true, path = "../benchmarking" }
frame-benchmarking = { version = "4.0.0-dev", default-features = false, optional = true, git = "https://github.com/paritytech/substrate.git", branch = "polkadot-v0.9.40" }
# frame-support = { version = "4.0.0-dev", default-features = false, path = "../support" }
frame-support = { version = "4.0.0-dev", default-features = false, git = "https://github.com/paritytech/substrate.git", branch = "polkadot-v0.9.40" }
# frame-system = { version = "4.0.0-dev", default-features = false, path = "../system" }
frame-system = { version = "4.0.0-dev", default-features = false, git = "https://github.com/paritytech/substrate.git", branch = "polkadot-v0.9.40" }
# sp-runtime = { version = "7.0.0", default-features = false, path = "../../primitives/runtime" }
sp-runtime = { version = "7.0.0", default-features = false, git = "https://github.com/paritytech/substrate.git", branch = "polkadot-v0.9.40" }
# sp-std = { version = "5.0.0", default-features = false, path = "../../primitives/std" }
sp-std = { version = "5.0.0", default-features = false, git = "https://github.com/paritytech/substrate.git", branch = "polkadot-v0.9.40" }
```

再者是`[dev-dependencies]`字段中的引用：

```toml
# pallet-transaction-payment = { version = "4.0.0-dev", path = "../transaction-payment" }
pallet-transaction-payment = { version = "4.0.0-dev", git = "https://github.com/paritytech/substrate.git", branch = "polkadot-v0.9.40" }
# sp-core = { version = "7.0.0", path = "../../primitives/core" }
sp-core = { version = "7.0.0", git = "https://github.com/paritytech/substrate.git", branch = "polkadot-v0.9.40" }
# sp-io = { version = "7.0.0", path = "../../primitives/io" }
sp-io = { version = "7.0.0", git = "https://github.com/paritytech/substrate.git", branch = "polkadot-v0.9.40" }
```

完成以上修改后，执行`cargo build --release`。编译未报错，尝试运行：

```bash
./target/release/node-template --dev
```

然后在[Polkadot.js APPs](https://polkadot.js.org/apps/?rpc=ws%3A%2F%2F127.0.0.1%3A9944)上执行转账操作和查询账户余额操作，无异常。可以认为修改成功。
